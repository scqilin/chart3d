(function(p,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],n):(p=typeof globalThis<"u"?globalThis:p||self,n(p.charts3d={},p.THREE))})(this,function(p,n){"use strict";var Ce=Object.defineProperty;var ke=(p,n,j)=>n in p?Ce(p,n,{enumerable:!0,configurable:!0,writable:!0,value:j}):p[n]=j;var G=(p,n,j)=>(ke(p,typeof n!="symbol"?n+"":n,j),j);function j(L){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(L){for(const l in L)if(l!=="default"){const e=Object.getOwnPropertyDescriptor(L,l);Object.defineProperty(r,l,e.get?e:{enumerable:!0,get:()=>L[l]})}}return r.default=L,Object.freeze(r)}const d=j(n);class me{constructor(r){G(this,"dom");this.dom=r,this.init()}init(){console.log("Charts3d")}getDomSize(){return{width:this.dom.offsetWidth||100,height:this.dom.offsetHeight||100}}createScene(){return new d.Scene}createCamera(){const{width:r,height:l}=this.getDomSize();return new d.PerspectiveCamera(75,r/l,.1,1e3)}createRenderer(){const r=new d.WebGLRenderer({antialias:!0,alpha:!0}),{width:l,height:e}=this.getDomSize();return r.setSize(l,e),this.dom.appendChild(r.domElement),r}createLight(){return new d.AmbientLight(4210752)}createCube(){const r=new d.BoxGeometry(3,3,3),l=new d.MeshNormalMaterial;return new d.Mesh(r,l)}initScene(){if(!this.dom)throw new Error("dom is not defined");const r=this.createScene(),l=this.createCamera(),e=this.createRenderer(),a=this.createLight(),i=this.createCube();r.add(a),r.add(i),l.position.z=6,l.position.y=3,l.lookAt(0,0,0);const N=function(){e.render(r,l),requestAnimationFrame(N),i.rotation.x+=.01,i.rotation.y+=.01};return N(),window.addEventListener("resize",()=>{const{width:c,height:m}=this.getDomSize();e.setSize(c,m),l.aspect=c/m,l.updateProjectionMatrix()}),r}}const W={type:"change"},K={type:"start"},q={type:"end"};class pe extends n.EventDispatcher{constructor(r,l){super(),this.object=r,this.domElement=l,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new n.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.DOLLY,RIGHT:n.MOUSE.PAN},this.touches={ONE:n.TOUCH.ROTATE,TWO:n.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Z),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(W),e.update(),i=a.NONE},this.update=function(){const t=new n.Vector3,o=new n.Quaternion().setFromUnitVectors(r.up,new n.Vector3(0,1,0)),h=o.clone().invert(),u=new n.Vector3,b=new n.Quaternion,I=2*Math.PI;return function(){const ue=e.object.position;t.copy(ue).sub(e.target),t.applyQuaternion(o),c.setFromVector3(t),e.autoRotate&&i===a.NONE&&v(ge()),e.enableDamping?(c.theta+=m.theta*e.dampingFactor,c.phi+=m.phi*e.dampingFactor):(c.theta+=m.theta,c.phi+=m.phi);let S=e.minAzimuthAngle,D=e.maxAzimuthAngle;return isFinite(S)&&isFinite(D)&&(S<-Math.PI?S+=I:S>Math.PI&&(S-=I),D<-Math.PI?D+=I:D>Math.PI&&(D-=I),S<=D?c.theta=Math.max(S,Math.min(D,c.theta)):c.theta=c.theta>(S+D)/2?Math.max(S,c.theta):Math.min(D,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=k,c.radius=Math.max(e.minDistance,Math.min(e.maxDistance,c.radius)),e.enableDamping===!0?e.target.addScaledVector(T,e.dampingFactor):e.target.add(T),t.setFromSpherical(c),t.applyQuaternion(h),ue.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(m.theta*=1-e.dampingFactor,m.phi*=1-e.dampingFactor,T.multiplyScalar(1-e.dampingFactor)):(m.set(0,0,0),T.set(0,0,0)),k=1,P||u.distanceToSquared(e.object.position)>N||8*(1-b.dot(e.object.quaternion))>N?(e.dispatchEvent(W),u.copy(e.object.position),b.copy(e.object.quaternion),P=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",le),e.domElement.removeEventListener("pointerdown",se),e.domElement.removeEventListener("pointercancel",re),e.domElement.removeEventListener("wheel",ce),e.domElement.removeEventListener("pointermove",F),e.domElement.removeEventListener("pointerup",R),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Z),e._domElementKeyEvents=null)};const e=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=a.NONE;const N=1e-6,c=new n.Spherical,m=new n.Spherical;let k=1;const T=new n.Vector3;let P=!1;const A=new n.Vector2,f=new n.Vector2,y=new n.Vector2,g=new n.Vector2,M=new n.Vector2,O=new n.Vector2,E=new n.Vector2,w=new n.Vector2,x=new n.Vector2,s=[],C={};function ge(){return 2*Math.PI/60/60*e.autoRotateSpeed}function U(){return Math.pow(.95,e.zoomSpeed)}function v(t){m.theta-=t}function _(t){m.phi-=t}const B=function(){const t=new n.Vector3;return function(h,u){t.setFromMatrixColumn(u,0),t.multiplyScalar(-h),T.add(t)}}(),Q=function(){const t=new n.Vector3;return function(h,u){e.screenSpacePanning===!0?t.setFromMatrixColumn(u,1):(t.setFromMatrixColumn(u,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(h),T.add(t)}}(),z=function(){const t=new n.Vector3;return function(h,u){const b=e.domElement;if(e.object.isPerspectiveCamera){const I=e.object.position;t.copy(I).sub(e.target);let Y=t.length();Y*=Math.tan(e.object.fov/2*Math.PI/180),B(2*h*Y/b.clientHeight,e.object.matrix),Q(2*u*Y/b.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(B(h*(e.object.right-e.object.left)/e.object.zoom/b.clientWidth,e.object.matrix),Q(u*(e.object.top-e.object.bottom)/e.object.zoom/b.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function V(t){e.object.isPerspectiveCamera?k/=t:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*t)),e.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function H(t){e.object.isPerspectiveCamera?k*=t:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/t)),e.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function J(t){A.set(t.clientX,t.clientY)}function be(t){E.set(t.clientX,t.clientY)}function $(t){g.set(t.clientX,t.clientY)}function ye(t){f.set(t.clientX,t.clientY),y.subVectors(f,A).multiplyScalar(e.rotateSpeed);const o=e.domElement;v(2*Math.PI*y.x/o.clientHeight),_(2*Math.PI*y.y/o.clientHeight),A.copy(f),e.update()}function we(t){w.set(t.clientX,t.clientY),x.subVectors(w,E),x.y>0?V(U()):x.y<0&&H(U()),E.copy(w),e.update()}function Pe(t){M.set(t.clientX,t.clientY),O.subVectors(M,g).multiplyScalar(e.panSpeed),z(O.x,O.y),g.copy(M),e.update()}function Me(t){t.deltaY<0?H(U()):t.deltaY>0&&V(U()),e.update()}function Oe(t){let o=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?_(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(0,e.keyPanSpeed),o=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?_(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(0,-e.keyPanSpeed),o=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?v(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(e.keyPanSpeed,0),o=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?v(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(-e.keyPanSpeed,0),o=!0;break}o&&(t.preventDefault(),e.update())}function ee(){if(s.length===1)A.set(s[0].pageX,s[0].pageY);else{const t=.5*(s[0].pageX+s[1].pageX),o=.5*(s[0].pageY+s[1].pageY);A.set(t,o)}}function te(){if(s.length===1)g.set(s[0].pageX,s[0].pageY);else{const t=.5*(s[0].pageX+s[1].pageX),o=.5*(s[0].pageY+s[1].pageY);g.set(t,o)}}function ne(){const t=s[0].pageX-s[1].pageX,o=s[0].pageY-s[1].pageY,h=Math.sqrt(t*t+o*o);E.set(0,h)}function Se(){e.enableZoom&&ne(),e.enablePan&&te()}function De(){e.enableZoom&&ne(),e.enableRotate&&ee()}function oe(t){if(s.length==1)f.set(t.pageX,t.pageY);else{const h=X(t),u=.5*(t.pageX+h.x),b=.5*(t.pageY+h.y);f.set(u,b)}y.subVectors(f,A).multiplyScalar(e.rotateSpeed);const o=e.domElement;v(2*Math.PI*y.x/o.clientHeight),_(2*Math.PI*y.y/o.clientHeight),A.copy(f)}function ae(t){if(s.length===1)M.set(t.pageX,t.pageY);else{const o=X(t),h=.5*(t.pageX+o.x),u=.5*(t.pageY+o.y);M.set(h,u)}O.subVectors(M,g).multiplyScalar(e.panSpeed),z(O.x,O.y),g.copy(M)}function ie(t){const o=X(t),h=t.pageX-o.x,u=t.pageY-o.y,b=Math.sqrt(h*h+u*u);w.set(0,b),x.set(0,Math.pow(w.y/E.y,e.zoomSpeed)),V(x.y),E.copy(w)}function Le(t){e.enableZoom&&ie(t),e.enablePan&&ae(t)}function Te(t){e.enableZoom&&ie(t),e.enableRotate&&oe(t)}function se(t){e.enabled!==!1&&(s.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",F),e.domElement.addEventListener("pointerup",R)),Ne(t),t.pointerType==="touch"?xe(t):Ae(t))}function F(t){e.enabled!==!1&&(t.pointerType==="touch"?je(t):Ee(t))}function R(t){de(t),s.length===0&&(e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",F),e.domElement.removeEventListener("pointerup",R)),e.dispatchEvent(q),i=a.NONE}function re(t){de(t)}function Ae(t){let o;switch(t.button){case 0:o=e.mouseButtons.LEFT;break;case 1:o=e.mouseButtons.MIDDLE;break;case 2:o=e.mouseButtons.RIGHT;break;default:o=-1}switch(o){case n.MOUSE.DOLLY:if(e.enableZoom===!1)return;be(t),i=a.DOLLY;break;case n.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;$(t),i=a.PAN}else{if(e.enableRotate===!1)return;J(t),i=a.ROTATE}break;case n.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;J(t),i=a.ROTATE}else{if(e.enablePan===!1)return;$(t),i=a.PAN}break;default:i=a.NONE}i!==a.NONE&&e.dispatchEvent(K)}function Ee(t){switch(i){case a.ROTATE:if(e.enableRotate===!1)return;ye(t);break;case a.DOLLY:if(e.enableZoom===!1)return;we(t);break;case a.PAN:if(e.enablePan===!1)return;Pe(t);break}}function ce(t){e.enabled===!1||e.enableZoom===!1||i!==a.NONE||(t.preventDefault(),e.dispatchEvent(K),Me(t),e.dispatchEvent(q))}function Z(t){e.enabled===!1||e.enablePan===!1||Oe(t)}function xe(t){switch(he(t),s.length){case 1:switch(e.touches.ONE){case n.TOUCH.ROTATE:if(e.enableRotate===!1)return;ee(),i=a.TOUCH_ROTATE;break;case n.TOUCH.PAN:if(e.enablePan===!1)return;te(),i=a.TOUCH_PAN;break;default:i=a.NONE}break;case 2:switch(e.touches.TWO){case n.TOUCH.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Se(),i=a.TOUCH_DOLLY_PAN;break;case n.TOUCH.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;De(),i=a.TOUCH_DOLLY_ROTATE;break;default:i=a.NONE}break;default:i=a.NONE}i!==a.NONE&&e.dispatchEvent(K)}function je(t){switch(he(t),i){case a.TOUCH_ROTATE:if(e.enableRotate===!1)return;oe(t),e.update();break;case a.TOUCH_PAN:if(e.enablePan===!1)return;ae(t),e.update();break;case a.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Le(t),e.update();break;case a.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Te(t),e.update();break;default:i=a.NONE}}function le(t){e.enabled!==!1&&t.preventDefault()}function Ne(t){s.push(t)}function de(t){delete C[t.pointerId];for(let o=0;o<s.length;o++)if(s[o].pointerId==t.pointerId){s.splice(o,1);return}}function he(t){let o=C[t.pointerId];o===void 0&&(o=new n.Vector2,C[t.pointerId]=o),o.set(t.pageX,t.pageY)}function X(t){const o=t.pointerId===s[0].pointerId?s[1]:s[0];return C[o.pointerId]}e.domElement.addEventListener("contextmenu",le),e.domElement.addEventListener("pointerdown",se),e.domElement.addEventListener("pointercancel",re),e.domElement.addEventListener("wheel",ce,{passive:!1}),this.update()}}class fe{constructor(r){G(this,"dom");this.dom=r}getDomSize(){return{width:this.dom.offsetWidth||100,height:this.dom.offsetHeight||100}}createRenderer(){const r=new d.WebGLRenderer({antialias:!0,alpha:!0}),{width:l,height:e}=this.getDomSize();return r.setSize(l,e),this.dom.appendChild(r.domElement),r}initScene(){if(!this.dom)throw new Error("dom is not defined");const{width:r,height:l}=this.getDomSize(),e=new d.Scene,a=new d.PerspectiveCamera(75,r/l,.1,1e3);a.position.z=6,a.position.y=3;const i=this.createRenderer(),N=new d.BoxGeometry(3,3,3),c=new d.MeshNormalMaterial,m=new d.Mesh(N,c);e.add(m);const k=new d.SphereGeometry(.5,32,32),T=new d.MeshNormalMaterial,P=new d.Mesh(k,T);P.position.x=3,e.add(P),new pe(a,i.domElement).update();const f=1,y=new d.OrthographicCamera(-f,f,f,-f,.1,1e3),g=new d.Scene;y.position.z=10,g.add(y);const M=new d.PlaneGeometry(f*2,f*2),O=new d.WebGLRenderTarget(r,l),E=new d.Mesh(M,new d.ShaderMaterial({uniforms:{tDiffuse:{value:O.texture}},vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform sampler2D tDiffuse;
                varying vec2 vUv;
                void main() {
                    float dx = step(0.7, fract(vUv.y * 20.0));
                    vec4 col = texture2D(tDiffuse, vUv);
                    col.r += dx;
                    gl_FragColor = col;
                }
            `,transparent:!0}));g.add(E);const w=new d.Clock,x=()=>{requestAnimationFrame(x),i.setRenderTarget(O),i.render(e,a),i.setRenderTarget(null),i.render(g,y),m.rotation.y=-w.getElapsedTime(),P.position.x=Math.sin(w.getElapsedTime())*3,P.position.z=Math.cos(w.getElapsedTime())*3};return x(),window.addEventListener("resize",()=>{const{width:s,height:C}=this.getDomSize();i.setSize(s,C),a.aspect=s/C,a.updateProjectionMatrix()}),e}}p.Demo=me,p.RenderTarget=fe,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
